name: CI - Project Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate Katalon Project Structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify project file exists
        run: |
          if [ -f "Katalon-ecommerce-automation/Katalon-ecommerce-automation.prj" ]; then
            echo "✅ Katalon project file found"
          else
            echo "❌ Katalon project file missing" && exit 1
          fi

      - name: Verify test cases exist
        run: |
          TC_COUNT=$(find "Katalon-ecommerce-automation/Test Cases" -name "*.tc" | wc -l)
          echo "✅ Found $TC_COUNT test case(s)"
          if [ "$TC_COUNT" -eq 0 ]; then
            echo "❌ No test cases found" && exit 1
          fi

      - name: Verify object repository exists
        run: |
          RS_COUNT=$(find "Katalon-ecommerce-automation/Object Repository" -name "*.rs" | wc -l)
          echo "✅ Found $RS_COUNT object(s) in repository"

      - name: Verify scripts exist
        run: |
          SCRIPT_COUNT=$(find "Katalon-ecommerce-automation/Scripts" -name "*.groovy" | wc -l)
          echo "✅ Found $SCRIPT_COUNT Groovy script(s)"
          if [ "$SCRIPT_COUNT" -eq 0 ]; then
            echo "❌ No Groovy scripts found" && exit 1
          fi

      - name: Print project summary
        run: |
          echo "========================================="
          echo "       Katalon Project Summary"
          echo "========================================="
          echo "Test Cases : $(find 'Katalon-ecommerce-automation/Test Cases' -name '*.tc' | wc -l)"
          echo "Scripts    : $(find 'Katalon-ecommerce-automation/Scripts' -name '*.groovy' | wc -l)"
          echo "Objects    : $(find 'Katalon-ecommerce-automation/Object Repository' -name '*.rs' | wc -l)"
          echo "========================================="
